"use strict";angular.module("chayka-auth").factory("linkedin",["nls","ajax","auth",function(nls,ajax,auth){var $=angular.element,lnkdn={$scope:null,autoAuth:!1,notAuthorized:!1,IN:window.IN,currentUser:window.Chayka.Users.currentUser,getIN:function(){if(!lnkdn.IN)if(window.IN)lnkdn.IN=window.IN,lnkdn.IN.Event.on(window.IN,"auth",lnkdn.onStatusChanged),lnkdn.autoAuth&&lnkdn.onLoginButtonClicked(lnkdn.autoAuth);else{var script=$("#linkedin_script");"text/template"===script.attr("type")&&($('<script type="text/javascript">').attr("src",script.attr("src")).text(script.text()).insertAfter(script),script.remove())}return lnkdn.IN},getInUserId:function(){return lnkdn.currentUser.meta.in_user_id},onStatusChanged:function(){lnkdn.onInLogin(lnkdn.IN.ENV.auth)},onLoginButtonClicked:function(event){lnkdn.autoAuth=event,event&&event.preventDefault(),lnkdn.getIN()&&lnkdn.IN.User.authorize(lnkdn.onStatusChanged,lnkdn)},onInLogin:function(INResponse){ajax.post("/api/linkedin/login",INResponse,{spinner:!1,showMessage:!1,errorMessage:nls._("message_error_auth_failed"),success:function(data){lnkdn.$scope.$emit("Chayka.Users.currentUserChanged",data.payload)},complete:function(){}})}};return auth.LinkedIn=lnkdn,lnkdn}]).directive("authLinkedinButton",["linkedin",function(lnkdn){var $=angular.element;return{restrict:"A",link:function($scope,element){lnkdn.getIN(),lnkdn.$scope=$scope,$(document).on("logout",lnkdn.logout),$(element).click(lnkdn.onLoginButtonClicked),$scope.$on("Chayka.Users.currentUserChanged",function(){})}}}]);